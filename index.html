<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙƒÙ†ØªØ±ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ | Ø±Ù…Ø¶Ø§Ù† 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #030712; color: white; }
        #admin-gate { position: fixed; inset: 0; background: #030712; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        #main-dashboard { display: none; }
        .nav-btn { padding: 10px 15px; border-radius: 10px; font-weight: bold; background: #1e293b; color: #94a3b8; border: none; cursor: pointer; }
        .nav-btn.active { background: linear-gradient(90deg, #b8860b, #d4af37); color: #000; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .q-block { background: #111827; border: 1px solid #374151; padding: 15px; border-radius: 15px; margin-bottom: 15px; }
    </style>
</head>
<body class="pb-20">

    <div id="admin-gate" class="p-4">
        <div class="bg-gray-900 p-8 rounded-2xl border border-yellow-600 w-full max-w-sm text-center shadow-2xl">
            <h2 class="text-xl font-black text-yellow-500 mb-6">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ”’</h2>
            <input type="password" id="gate-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±..." class="w-full p-3 bg-gray-800 rounded-xl mb-4 text-center border border-gray-700 outline-none">
            <button onclick="checkGate()" class="w-full bg-yellow-600 text-black font-bold py-3 rounded-xl">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="main-dashboard" class="p-4 max-w-6xl mx-auto">
        <header class="flex justify-center gap-2 mb-8 border-b border-gray-800 pb-4 overflow-x-auto">
            <button onclick="switchTab('users')" id="btn-users" class="nav-btn active">Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ğŸ‘¥</button>
            <button onclick="switchTab('quizzes')" id="btn-quizzes" class="nav-btn">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ğŸ®</button>
            <button onclick="switchTab('groups')" id="btn-groups" class="nav-btn">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ğŸ†</button>
        </header>

        <div id="tab-users" class="tab-content active">
            <div class="bg-gray-900 p-6 rounded-2xl border border-gray-800 mb-8 shadow-xl">
                <h3 class="text-yellow-500 font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…ØªØ³Ø§Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <input type="text" id="add-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="bg-gray-800 p-3 rounded-xl border border-gray-700">
                    <input type="text" id="add-group" placeholder="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©" class="bg-gray-800 p-3 rounded-xl border border-gray-700">
                    <input type="text" id="add-pass" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„" class="bg-gray-800 p-3 rounded-xl border border-gray-700">
                    <button onclick="addUser()" class="bg-yellow-600 text-black font-black rounded-xl hover:bg-yellow-500 transition">Ø¥Ø¶Ø§ÙØ© â•</button>
                </div>
            </div>
            <div class="overflow-x-auto bg-gray-900 rounded-2xl border border-gray-800 shadow-2xl">
                <table class="w-full text-right text-sm">
                    <thead class="bg-gray-800 text-gray-400 font-bold">
                        <tr><th class="p-4">Ø§Ù„Ø§Ø³Ù…</th><th class="p-4">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</th><th class="p-4">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th><th class="p-4 text-center">Ø§Ù„Ù†Ù‚Ø§Ø·</th><th class="p-4 text-center">Ø§Ù„ØªØ­ÙƒÙ…</th></tr>
                    </thead>
                    <tbody id="users-body"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-quizzes" class="tab-content space-y-6">
            <div class="bg-gray-900 p-6 rounded-2xl border border-yellow-600/30 shadow-xl text-center">
                <h3 class="text-yellow-500 font-bold mb-4">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†</h3>
                <div class="flex flex-wrap justify-center gap-3">
                    <select id="day-select" class="bg-gray-800 p-3 rounded-xl border border-gray-700 font-bold text-white w-40"></select>
                    <button onclick="updateStatus('active')" class="bg-green-600 px-6 py-3 rounded-xl font-bold">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
                    <button onclick="updateStatus('closed')" class="bg-red-600 px-6 py-3 rounded-xl font-bold">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
                </div>
            </div>
            <div class="bg-gray-900 p-6 rounded-2xl border border-gray-800 shadow-xl">
                <h3 class="text-blue-400 font-bold mb-4 text-center">Ù…Ù†Ø´Ø¦ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯</h3>
                <div id="q-area" class="space-y-4"></div>
                <button onclick="saveQuiz()" class="w-full bg-yellow-600 text-black font-black py-4 mt-6 rounded-xl text-lg shadow-lg">Ø±ÙØ¹ Ø§Ù„ÙƒÙˆÙŠØ² Ù„Ù„Ø³ÙŠØ±ÙØ± ğŸš€</button>
            </div>
        </div>

        <div id="tab-groups" class="tab-content">
            <div id="groups-list" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        const ADMIN_PASS = "1234"; // ğŸ”‘ ÙƒÙ„Ù…Ø© Ø³Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        const firebaseConfig = { apiKey: "AIzaSyBZMnIJ_IOqeAfXqFt-m4tM1Lvo0tUDnk8", projectId: "ramadan-87817", appId: "1:343525703258:web:6776b4857425df8bcca263" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function checkGate() {
            if(document.getElementById('gate-pass').value === ADMIN_PASS) {
                document.getElementById('admin-gate').style.display = 'none';
                document.getElementById('main-dashboard').style.display = 'block';
                loadUsers();
            } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·!"); }
        }

        for(let i=1; i<=30; i++) document.getElementById('day-select').innerHTML += `<option value="${i}">Ø§Ù„ÙŠÙˆÙ… ${i}</option>`;
        for(let i=1; i<=15; i++) {
            document.getElementById('q-area').innerHTML += `<div class="q-block"><p class="text-yellow-500 text-xs mb-2">Ø³Ø¤Ø§Ù„ ${i}</p><textarea class="q-txt w-full bg-gray-800 p-2 rounded mb-2 text-white border border-gray-700"></textarea><div class="grid grid-cols-2 gap-2"><input class="o1 bg-gray-800 p-2 text-xs rounded border border-gray-700 text-white" placeholder="1"><input class="o2 bg-gray-800 p-2 text-xs rounded border border-gray-700 text-white" placeholder="2"><input class="o3 bg-gray-800 p-2 text-xs rounded border border-gray-700 text-white" placeholder="3"><input class="o4 bg-gray-800 p-2 text-xs rounded border border-gray-700 text-white" placeholder="4"></div><select class="cor w-full bg-gray-800 p-2 text-xs font-bold text-green-400 mt-2 border border-gray-700"><option value="0">Ø§Ù„ØµØ­: 1</option><option value="1">Ø§Ù„ØµØ­: 2</option><option value="2">Ø§Ù„ØµØ­: 3</option><option value="3">Ø§Ù„ØµØ­: 4</option></select></div>`;
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.getElementById('btn-'+t).classList.add('active');
            if(t==='users'||t==='groups') loadUsers();
        }

        function addUser() {
            const n = document.getElementById('add-name').value;
            const g = document.getElementById('add-group').value;
            const p = document.getElementById('add-pass').value;
            if(!n || !p) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±!");
            db.collection("users").add({ name: n, group: g, password: p, score: 0, isBanned: false }).then(() => { alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ!"); loadUsers(); });
        }

        function loadUsers() {
            const list = document.getElementById('users-body');
            const groupsDiv = document.getElementById('groups-list');
            db.collection("users").get().then(snap => {
                list.innerHTML = ""; groupsDiv.innerHTML = "";
                let users = []; let gMap = {};
                snap.forEach(d => { let u = d.data(); u.id = d.id; users.push(u); if(!gMap[u.group]) gMap[u.group]=[]; gMap[u.group].push(u); });
                users.sort((a,b) => (b.score||0)-(a.score||0)).forEach(u => {
                    const isBanned = u.isBanned || false;
                    list.innerHTML += `<tr class="border-b border-gray-800"><td class="p-4 ${isBanned ? 'text-gray-500' : 'text-yellow-500 font-bold'}">${u.name}</td><td class="p-4 text-xs text-gray-400">${u.password}</td><td class="p-4 text-xs text-blue-300">${u.group}</td><td class="p-4 text-center font-black">${u.score||0}</td><td class="p-4 text-center flex gap-1 justify-center"><button onclick="editSc('${u.id}',${u.score||0})" class="bg-gray-800 text-blue-400 p-2 rounded"><i class="fas fa-edit"></i></button><button onclick="toggleB('${u.id}',${isBanned})" class="text-orange-400 p-2 rounded"><i class="fas fa-ban"></i></button><button onclick="delU('${u.id}')" class="text-red-500 p-2 rounded"><i class="fas fa-trash"></i></button></td></tr>`;
                });
                for(let g in gMap) {
                    let items = gMap[g].sort((a,b)=>(b.score||0)-(a.score||0)).map((m,i)=>`<div class="flex justify-between bg-gray-900 p-2 mb-1 rounded text-xs"><span>${i+1}. ${m.name}</span><span class="text-yellow-500 font-bold">${m.score||0}</span></div>`).join('');
                    groupsDiv.innerHTML += `<div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg"><h3>${g}</h3><div class="mt-2">${items}</div></div>`;
                }
            });
        }

        function editSc(id, cur) { let nw = prompt("Ø§Ù„Ù†Ù‚Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", cur); if(nw !== null) db.collection("users").doc(id).update({score: parseInt(nw)}).then(loadUsers); }
        function toggleB(id, st) { db.collection("users").doc(id).update({isBanned: !st}).then(loadUsers); }
        function delU(id) { if(confirm("Ù…Ø³Ø­ Ù†Ù‡Ø§Ø¦ÙŠØŸ")) db.collection("users").doc(id).delete().then(loadUsers); }
        
        function updateStatus(st) {
            const d = document.getElementById('day-select').value;
            db.collection("settings").doc("global_status").set({ status: st, currentDay: parseInt(d), updatedAt: firebase.firestore.FieldValue.serverTimestamp() }).then(() => alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹!"));
        }

        function saveQuiz() {
            const day = document.getElementById('day-select').value;
            const qs = Array.from(document.querySelectorAll('.q-block')).map(b => ({
                q: b.querySelector('.q-txt').value,
                options: [b.querySelector('.o1').value, b.querySelector('.o2').value, b.querySelector('.o3').value, b.querySelector('.o4').value],
                correctIndex: parseInt(b.querySelector('.cor').value)
            }));
            db.collection("quizzes_pool").doc("day_"+day).set({ variations: [{ questions: qs }] }).then(() => alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„ÙƒÙˆÙŠØ² Ù„Ù„ÙŠÙˆÙ… "+day));
        }
    </script>
</body>
                </html>
                        
